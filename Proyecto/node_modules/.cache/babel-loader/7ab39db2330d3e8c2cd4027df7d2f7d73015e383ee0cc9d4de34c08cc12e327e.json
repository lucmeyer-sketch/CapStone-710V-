{"ast":null,"code":"import { supabase } from '../supabaseClient';\n/**\n * Iniciar sesión con email y contraseña\n * NOTA: En producción, las contraseñas deben estar hasheadas\n */\nexport const login = async (email, password) => {\n  try {\n    // buscar usuario por email\n    const {\n      data: usuario,\n      error: usuarioError\n    } = await supabase.from('usuarios').select('*').eq('email', email.toLowerCase().trim()).eq('activo', true).single();\n    if (usuarioError || !usuario) {\n      return {\n        success: false,\n        error: 'Credenciales incorrectas'\n      };\n    }\n\n    // verificar contraseña (NOTA: en producción usar bcrypt)\n    // por ahora comparación simple\n    if (usuario.password_hash !== password) {\n      return {\n        success: false,\n        error: 'Credenciales incorrectas'\n      };\n    }\n\n    // actualizar último acceso\n    await supabase.from('usuarios').update({\n      ultimo_acceso: new Date().toISOString()\n    }).eq('id', usuario.id);\n\n    // obtener detalles según el rol\n    let detalles = null;\n    if (usuario.rol === 'estudiante') {\n      const {\n        data: estudiante\n      } = await supabase.from('Estudiantes').select('id, rut, nombre, apellido, telefono, grado, seccion').eq('usuario_id', usuario.id).single();\n      detalles = estudiante;\n    } else if (usuario.rol === 'docente') {\n      // Obtener información completa del docente incluyendo materia\n      const {\n        data: docente,\n        error: docenteError\n      } = await supabase.from('docentes').select('id, rut, nombre, apellido, telefono, especialidad, materia_id, grados_asignados').eq('usuario_id', usuario.id).single();\n      if (docenteError) {\n        console.error('Error al cargar docente:', docenteError);\n      }\n      if (docente) {\n        // Obtener información de la materia asignada\n        let materia = null;\n        if (docente.materia_id) {\n          const {\n            data: materiaData,\n            error: materiaError\n          } = await supabase.from('materias').select('id, nombre, codigo').eq('id', docente.materia_id).single();\n          if (materiaError) {\n            console.error('Error al cargar materia:', materiaError);\n          } else {\n            materia = materiaData;\n          }\n        }\n\n        // Parsear grados asignados de forma segura\n        let grados_array = [];\n        if (docente.grados_asignados) {\n          try {\n            // Si es string, parsearlo\n            if (typeof docente.grados_asignados === 'string') {\n              grados_array = JSON.parse(docente.grados_asignados);\n            }\n            // Si ya es un array, usarlo directamente\n            else if (Array.isArray(docente.grados_asignados)) {\n              grados_array = docente.grados_asignados;\n            }\n          } catch (error) {\n            console.error('Error al parsear grados_asignados:', error, docente.grados_asignados);\n            grados_array = [];\n          }\n        }\n        console.log('Docente cargado (login):', {\n          id: docente.id,\n          nombre: docente.nombre,\n          materia_id: docente.materia_id,\n          materia: materia,\n          grados_asignados_raw: docente.grados_asignados,\n          grados_array: grados_array\n        });\n        detalles = {\n          ...docente,\n          materia,\n          grados_array\n        };\n      }\n    }\n    return {\n      success: true,\n      usuario: {\n        ...usuario,\n        detalles\n      }\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: 'Error al iniciar sesión: ' + error.message\n    };\n  }\n};\n\n/**\n * Obtener usuario por ID\n */\nexport const getUsuarioById = async id => {\n  try {\n    const {\n      data: usuario,\n      error\n    } = await supabase.from('usuarios').select('*').eq('id', id).single();\n    if (error || !usuario) return null;\n\n    // obtener detalles según el rol\n    let detalles = null;\n    if (usuario.rol === 'estudiante') {\n      const {\n        data: estudiante\n      } = await supabase.from('Estudiantes').select('id, rut, nombre, apellido, telefono, grado, seccion').eq('usuario_id', usuario.id).single();\n      detalles = estudiante;\n    } else if (usuario.rol === 'docente') {\n      // Obtener información completa del docente incluyendo materia\n      const {\n        data: docente,\n        error: docenteError\n      } = await supabase.from('docentes').select('id, rut, nombre, apellido, telefono, especialidad, materia_id, grados_asignados').eq('usuario_id', usuario.id).single();\n      if (docenteError) {\n        console.error('Error al cargar docente:', docenteError);\n      }\n      if (docente) {\n        // Obtener información de la materia asignada\n        let materia = null;\n        if (docente.materia_id) {\n          const {\n            data: materiaData,\n            error: materiaError\n          } = await supabase.from('materias').select('id, nombre, codigo').eq('id', docente.materia_id).single();\n          if (materiaError) {\n            console.error('Error al cargar materia:', materiaError);\n          } else {\n            materia = materiaData;\n          }\n        }\n\n        // Parsear grados asignados de forma segura\n        let grados_array = [];\n        if (docente.grados_asignados) {\n          try {\n            // Si es string, parsearlo\n            if (typeof docente.grados_asignados === 'string') {\n              grados_array = JSON.parse(docente.grados_asignados);\n            }\n            // Si ya es un array, usarlo directamente\n            else if (Array.isArray(docente.grados_asignados)) {\n              grados_array = docente.grados_asignados;\n            }\n          } catch (error) {\n            console.error('Error al parsear grados_asignados:', error, docente.grados_asignados);\n            grados_array = [];\n          }\n        }\n        console.log('Docente cargado (getUsuarioById):', {\n          id: docente.id,\n          nombre: docente.nombre,\n          materia_id: docente.materia_id,\n          materia: materia,\n          grados_asignados_raw: docente.grados_asignados,\n          grados_array: grados_array\n        });\n        detalles = {\n          ...docente,\n          materia,\n          grados_array\n        };\n      }\n    }\n    return {\n      ...usuario,\n      detalles\n    };\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Verificar si un email ya existe\n */\nexport const emailExists = async email => {\n  const {\n    data,\n    error\n  } = await supabase.from('usuarios').select('id').eq('email', email.toLowerCase().trim()).single();\n  return !error && data !== null;\n};\n\n/**\n * Cambiar contraseña\n */\nexport const cambiarPassword = async (usuarioId, passwordActual, passwordNueva) => {\n  try {\n    // verificar contraseña actual\n    const {\n      data: usuario,\n      error\n    } = await supabase.from('usuarios').select('password_hash').eq('id', usuarioId).single();\n    if (error || !usuario) {\n      return {\n        success: false,\n        error: 'Usuario no encontrado'\n      };\n    }\n    if (usuario.password_hash !== passwordActual) {\n      return {\n        success: false,\n        error: 'Contraseña actual incorrecta'\n      };\n    }\n\n    // actualizar contraseña\n    const {\n      error: updateError\n    } = await supabase.from('usuarios').update({\n      password_hash: passwordNueva\n    }).eq('id', usuarioId);\n    if (updateError) {\n      return {\n        success: false,\n        error: 'Error al actualizar contraseña'\n      };\n    }\n    return {\n      success: true\n    };\n  } catch (error) {\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n};\n\n/**\n * Crear sesión (opcional, para tracking)\n */\nexport const crearSesion = async (usuarioId, token, duracionHoras = 24) => {\n  const expiraEn = new Date();\n  expiraEn.setHours(expiraEn.getHours() + duracionHoras);\n  await supabase.from('sesiones').insert({\n    usuario_id: usuarioId,\n    token,\n    expira_en: expiraEn.toISOString()\n  });\n};\n\n/**\n * Cerrar sesión (limpiar sesiones)\n */\nexport const logout = async usuarioId => {\n  // eliminar sesiones expiradas o del usuario\n  await supabase.from('sesiones').delete().eq('usuario_id', usuarioId);\n};\n\n/**\n * Obtener todos los usuarios (admin)\n */\nexport const getAllUsuarios = async () => {\n  const {\n    data,\n    error\n  } = await supabase.from('usuarios').select('*').order('rol', {\n    ascending: true\n  }).order('email', {\n    ascending: true\n  });\n  if (error) throw error;\n  return data || [];\n};","map":{"version":3,"names":["supabase","login","email","password","data","usuario","error","usuarioError","from","select","eq","toLowerCase","trim","single","success","password_hash","update","ultimo_acceso","Date","toISOString","id","detalles","rol","estudiante","docente","docenteError","console","materia","materia_id","materiaData","materiaError","grados_array","grados_asignados","JSON","parse","Array","isArray","log","nombre","grados_asignados_raw","message","getUsuarioById","emailExists","cambiarPassword","usuarioId","passwordActual","passwordNueva","updateError","crearSesion","token","duracionHoras","expiraEn","setHours","getHours","insert","usuario_id","expira_en","logout","delete","getAllUsuarios","order","ascending"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/Proyecto/src/services/authService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\n\nexport interface Usuario {\n  id: number;\n  email: string;\n  rol: 'estudiante' | 'docente' | 'admin' | 'psicologo' | 'director';\n  activo: boolean;\n  ultimo_acceso?: string;\n  created_at?: string;\n}\n\nexport interface UsuarioConDetalles extends Usuario {\n  detalles?: {\n    id: number;\n    rut?: string;\n    nombre: string;\n    apellido: string;\n    telefono?: string;\n    grado?: string;\n    seccion?: string;\n    especialidad?: string;\n    // Propiedades específicas para docentes\n    materia?: {\n      id: number;\n      nombre: string;\n      codigo: string;\n    };\n    grados_array?: string[]; // Array de grados asignados: [\"10°A\", \"10°B\"]\n  };\n}\n\nexport interface LoginResponse {\n  success: boolean;\n  usuario?: UsuarioConDetalles;\n  error?: string;\n}\n\n/**\n * Iniciar sesión con email y contraseña\n * NOTA: En producción, las contraseñas deben estar hasheadas\n */\nexport const login = async (email: string, password: string): Promise<LoginResponse> => {\n  try {\n    // buscar usuario por email\n    const { data: usuario, error: usuarioError } = await supabase\n      .from('usuarios')\n      .select('*')\n      .eq('email', email.toLowerCase().trim())\n      .eq('activo', true)\n      .single();\n\n    if (usuarioError || !usuario) {\n      return {\n        success: false,\n        error: 'Credenciales incorrectas'\n      };\n    }\n\n    // verificar contraseña (NOTA: en producción usar bcrypt)\n    // por ahora comparación simple\n    if (usuario.password_hash !== password) {\n      return {\n        success: false,\n        error: 'Credenciales incorrectas'\n      };\n    }\n\n    // actualizar último acceso\n    await supabase\n      .from('usuarios')\n      .update({ ultimo_acceso: new Date().toISOString() })\n      .eq('id', usuario.id);\n\n    // obtener detalles según el rol\n    let detalles = null;\n\n    if (usuario.rol === 'estudiante') {\n      const { data: estudiante } = await supabase\n        .from('Estudiantes')\n        .select('id, rut, nombre, apellido, telefono, grado, seccion')\n        .eq('usuario_id', usuario.id)\n        .single();\n      \n      detalles = estudiante;\n    } else if (usuario.rol === 'docente') {\n      // Obtener información completa del docente incluyendo materia\n      const { data: docente, error: docenteError } = await supabase\n        .from('docentes')\n        .select('id, rut, nombre, apellido, telefono, especialidad, materia_id, grados_asignados')\n        .eq('usuario_id', usuario.id)\n        .single();\n\n      if (docenteError) {\n        console.error('Error al cargar docente:', docenteError);\n      }\n\n      if (docente) {\n        // Obtener información de la materia asignada\n        let materia = null;\n        if (docente.materia_id) {\n          const { data: materiaData, error: materiaError } = await supabase\n            .from('materias')\n            .select('id, nombre, codigo')\n            .eq('id', docente.materia_id)\n            .single();\n          \n          if (materiaError) {\n            console.error('Error al cargar materia:', materiaError);\n          } else {\n            materia = materiaData;\n          }\n        }\n\n        // Parsear grados asignados de forma segura\n        let grados_array: string[] = [];\n        if (docente.grados_asignados) {\n          try {\n            // Si es string, parsearlo\n            if (typeof docente.grados_asignados === 'string') {\n              grados_array = JSON.parse(docente.grados_asignados);\n            } \n            // Si ya es un array, usarlo directamente\n            else if (Array.isArray(docente.grados_asignados)) {\n              grados_array = docente.grados_asignados;\n            }\n          } catch (error) {\n            console.error('Error al parsear grados_asignados:', error, docente.grados_asignados);\n            grados_array = [];\n          }\n        }\n\n        console.log('Docente cargado (login):', {\n          id: docente.id,\n          nombre: docente.nombre,\n          materia_id: docente.materia_id,\n          materia: materia,\n          grados_asignados_raw: docente.grados_asignados,\n          grados_array: grados_array\n        });\n\n        detalles = {\n          ...docente,\n          materia,\n          grados_array\n        };\n      }\n    }\n\n    return {\n      success: true,\n      usuario: {\n        ...usuario,\n        detalles\n      }\n    };\n\n  } catch (error: any) {\n    return {\n      success: false,\n      error: 'Error al iniciar sesión: ' + error.message\n    };\n  }\n};\n\n/**\n * Obtener usuario por ID\n */\nexport const getUsuarioById = async (id: number): Promise<UsuarioConDetalles | null> => {\n  try {\n    const { data: usuario, error } = await supabase\n      .from('usuarios')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error || !usuario) return null;\n\n    // obtener detalles según el rol\n    let detalles = null;\n\n    if (usuario.rol === 'estudiante') {\n      const { data: estudiante } = await supabase\n        .from('Estudiantes')\n        .select('id, rut, nombre, apellido, telefono, grado, seccion')\n        .eq('usuario_id', usuario.id)\n        .single();\n      \n      detalles = estudiante;\n    } else if (usuario.rol === 'docente') {\n      // Obtener información completa del docente incluyendo materia\n      const { data: docente, error: docenteError } = await supabase\n        .from('docentes')\n        .select('id, rut, nombre, apellido, telefono, especialidad, materia_id, grados_asignados')\n        .eq('usuario_id', usuario.id)\n        .single();\n\n      if (docenteError) {\n        console.error('Error al cargar docente:', docenteError);\n      }\n\n      if (docente) {\n        // Obtener información de la materia asignada\n        let materia = null;\n        if (docente.materia_id) {\n          const { data: materiaData, error: materiaError } = await supabase\n            .from('materias')\n            .select('id, nombre, codigo')\n            .eq('id', docente.materia_id)\n            .single();\n          \n          if (materiaError) {\n            console.error('Error al cargar materia:', materiaError);\n          } else {\n            materia = materiaData;\n          }\n        }\n\n        // Parsear grados asignados de forma segura\n        let grados_array: string[] = [];\n        if (docente.grados_asignados) {\n          try {\n            // Si es string, parsearlo\n            if (typeof docente.grados_asignados === 'string') {\n              grados_array = JSON.parse(docente.grados_asignados);\n            } \n            // Si ya es un array, usarlo directamente\n            else if (Array.isArray(docente.grados_asignados)) {\n              grados_array = docente.grados_asignados;\n            }\n          } catch (error) {\n            console.error('Error al parsear grados_asignados:', error, docente.grados_asignados);\n            grados_array = [];\n          }\n        }\n\n        console.log('Docente cargado (getUsuarioById):', {\n          id: docente.id,\n          nombre: docente.nombre,\n          materia_id: docente.materia_id,\n          materia: materia,\n          grados_asignados_raw: docente.grados_asignados,\n          grados_array: grados_array\n        });\n\n        detalles = {\n          ...docente,\n          materia,\n          grados_array\n        };\n      }\n    }\n\n    return {\n      ...usuario,\n      detalles\n    };\n\n  } catch (error) {\n    return null;\n  }\n};\n\n/**\n * Verificar si un email ya existe\n */\nexport const emailExists = async (email: string): Promise<boolean> => {\n  const { data, error } = await supabase\n    .from('usuarios')\n    .select('id')\n    .eq('email', email.toLowerCase().trim())\n    .single();\n\n  return !error && data !== null;\n};\n\n/**\n * Cambiar contraseña\n */\nexport const cambiarPassword = async (\n  usuarioId: number,\n  passwordActual: string,\n  passwordNueva: string\n): Promise<{ success: boolean; error?: string }> => {\n  try {\n    // verificar contraseña actual\n    const { data: usuario, error } = await supabase\n      .from('usuarios')\n      .select('password_hash')\n      .eq('id', usuarioId)\n      .single();\n\n    if (error || !usuario) {\n      return { success: false, error: 'Usuario no encontrado' };\n    }\n\n    if (usuario.password_hash !== passwordActual) {\n      return { success: false, error: 'Contraseña actual incorrecta' };\n    }\n\n    // actualizar contraseña\n    const { error: updateError } = await supabase\n      .from('usuarios')\n      .update({ password_hash: passwordNueva })\n      .eq('id', usuarioId);\n\n    if (updateError) {\n      return { success: false, error: 'Error al actualizar contraseña' };\n    }\n\n    return { success: true };\n\n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n};\n\n/**\n * Crear sesión (opcional, para tracking)\n */\nexport const crearSesion = async (\n  usuarioId: number,\n  token: string,\n  duracionHoras: number = 24\n): Promise<void> => {\n  const expiraEn = new Date();\n  expiraEn.setHours(expiraEn.getHours() + duracionHoras);\n\n  await supabase.from('sesiones').insert({\n    usuario_id: usuarioId,\n    token,\n    expira_en: expiraEn.toISOString()\n  });\n};\n\n/**\n * Cerrar sesión (limpiar sesiones)\n */\nexport const logout = async (usuarioId: number): Promise<void> => {\n  // eliminar sesiones expiradas o del usuario\n  await supabase\n    .from('sesiones')\n    .delete()\n    .eq('usuario_id', usuarioId);\n};\n\n/**\n * Obtener todos los usuarios (admin)\n */\nexport const getAllUsuarios = async (): Promise<Usuario[]> => {\n  const { data, error } = await supabase\n    .from('usuarios')\n    .select('*')\n    .order('rol', { ascending: true })\n    .order('email', { ascending: true });\n\n  if (error) throw error;\n  return data || [];\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}