{"ast":null,"code":"import { supabase } from '../supabaseClient';\n// obtener todas las calificaciones de un estudiante\nexport const getCalificacionesByEstudiante = async estudianteId => {\n  // Obtener calificaciones con clases y materias (sin docente)\n  const {\n    data: calificacionesData,\n    error: calificacionesError\n  } = await supabase.from('calificaciones').select(`\n      *,\n      clase:clases (\n        *,\n        materia:materias (*)\n      )\n    `).eq('estudiante_id', estudianteId).order('fecha_evaluacion', {\n    ascending: false\n  });\n  if (calificacionesError) throw calificacionesError;\n  if (!calificacionesData || calificacionesData.length === 0) return [];\n\n  // Obtener IDs únicos de docentes\n  const docenteIds = Array.from(new Set(calificacionesData.map(cal => {\n    var _cal$clase;\n    return (_cal$clase = cal.clase) === null || _cal$clase === void 0 ? void 0 : _cal$clase.docente_id;\n  }).filter(id => id !== undefined && id !== null)));\n\n  // Obtener información de docentes por separado\n  let docentesData = [];\n  if (docenteIds.length > 0) {\n    const {\n      data,\n      error: docentesError\n    } = await supabase.from('docentes').select('id, nombre, apellido').in('id', docenteIds);\n    if (docentesError) throw docentesError;\n    docentesData = data || [];\n  }\n\n  // Combinar datos\n  return calificacionesData.map(calificacion => {\n    const clase = calificacion.clase;\n    if (!clase) return calificacion;\n\n    // Encontrar docente correspondiente\n    const docente = docentesData.find(d => d.id === clase.docente_id);\n    return {\n      ...calificacion,\n      clase: {\n        ...clase,\n        docente: docente ? {\n          id: docente.id,\n          nombre: docente.nombre,\n          apellido: docente.apellido\n        } : undefined\n      }\n    };\n  });\n};\n\n// obtener calificaciones por clase\nexport const getCalificacionesByClase = async claseId => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select(`\n      *,\n      estudiante:Estudiantes (\n        nombre,\n        apellido,\n        grado,\n        seccion\n      )\n    `).eq('clase_id', claseId).order('fecha_evaluacion', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// crear calificación\nexport const createCalificacion = async calificacion => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').insert(calificacion).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// actualizar calificación\nexport const updateCalificacion = async (id, calificacion) => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').update(calificacion).eq('id', id).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// eliminar calificación\nexport const deleteCalificacion = async id => {\n  const {\n    error\n  } = await supabase.from('calificaciones').delete().eq('id', id);\n  if (error) throw error;\n};\n\n// calcular promedio de un estudiante en una clase\nexport const getPromedioEstudianteClase = async (estudianteId, claseId) => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select('nota, ponderacion').eq('estudiante_id', estudianteId).eq('clase_id', claseId);\n  if (error) throw error;\n  if (!data || data.length === 0) return 0;\n\n  // calcular promedio ponderado\n  const totalPonderacion = data.reduce((sum, cal) => sum + (cal.ponderacion || 100), 0);\n  const sumaNotas = data.reduce((sum, cal) => sum + cal.nota * (cal.ponderacion || 100), 0);\n  return parseFloat((sumaNotas / totalPonderacion).toFixed(1));\n};\n\n// obtener promedio general del estudiante\nexport const getPromedioGeneralEstudiante = async estudianteId => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select('nota').eq('estudiante_id', estudianteId);\n  if (error) throw error;\n  if (!data || data.length === 0) return 0;\n  const promedio = data.reduce((sum, cal) => sum + cal.nota, 0) / data.length;\n  return parseFloat(promedio.toFixed(1));\n};","map":{"version":3,"names":["supabase","getCalificacionesByEstudiante","estudianteId","data","calificacionesData","error","calificacionesError","from","select","eq","order","ascending","length","docenteIds","Array","Set","map","cal","_cal$clase","clase","docente_id","filter","id","undefined","docentesData","docentesError","in","calificacion","docente","find","d","nombre","apellido","getCalificacionesByClase","claseId","createCalificacion","insert","single","updateCalificacion","update","deleteCalificacion","delete","getPromedioEstudianteClase","totalPonderacion","reduce","sum","ponderacion","sumaNotas","nota","parseFloat","toFixed","getPromedioGeneralEstudiante","promedio"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/Proyecto/src/services/calificacionService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\r\nimport { Calificacion, CalificacionConDetalles } from '../types/database';\r\n\r\n// obtener todas las calificaciones de un estudiante\r\nexport const getCalificacionesByEstudiante = async (\r\n  estudianteId: string\r\n): Promise<CalificacionConDetalles[]> => {\r\n  // Obtener calificaciones con clases y materias (sin docente)\r\n  const { data: calificacionesData, error: calificacionesError } = await supabase\r\n    .from('calificaciones')\r\n    .select(`\r\n      *,\r\n      clase:clases (\r\n        *,\r\n        materia:materias (*)\r\n      )\r\n    `)\r\n    .eq('estudiante_id', estudianteId)\r\n    .order('fecha_evaluacion', { ascending: false });\r\n\r\n  if (calificacionesError) throw calificacionesError;\r\n  if (!calificacionesData || calificacionesData.length === 0) return [];\r\n\r\n  // Obtener IDs únicos de docentes\r\n  const docenteIds = Array.from(\r\n    new Set(\r\n      calificacionesData\r\n        .map(cal => cal.clase?.docente_id)\r\n        .filter((id): id is number => id !== undefined && id !== null)\r\n    )\r\n  );\r\n\r\n  // Obtener información de docentes por separado\r\n  let docentesData: any[] = [];\r\n  if (docenteIds.length > 0) {\r\n    const { data, error: docentesError } = await supabase\r\n      .from('docentes')\r\n      .select('id, nombre, apellido')\r\n      .in('id', docenteIds);\r\n\r\n    if (docentesError) throw docentesError;\r\n    docentesData = data || [];\r\n  }\r\n\r\n  // Combinar datos\r\n  return calificacionesData.map(calificacion => {\r\n    const clase = calificacion.clase;\r\n    if (!clase) return calificacion;\r\n\r\n    // Encontrar docente correspondiente\r\n    const docente = docentesData.find(d => d.id === clase.docente_id);\r\n\r\n    return {\r\n      ...calificacion,\r\n      clase: {\r\n        ...clase,\r\n        docente: docente ? {\r\n          id: docente.id,\r\n          nombre: docente.nombre,\r\n          apellido: docente.apellido\r\n        } : undefined\r\n      }\r\n    };\r\n  });\r\n};\r\n\r\n// obtener calificaciones por clase\r\nexport const getCalificacionesByClase = async (\r\n  claseId: string\r\n): Promise<CalificacionConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select(`\r\n      *,\r\n      estudiante:Estudiantes (\r\n        nombre,\r\n        apellido,\r\n        grado,\r\n        seccion\r\n      )\r\n    `)\r\n    .eq('clase_id', claseId)\r\n    .order('fecha_evaluacion', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// crear calificación\r\nexport const createCalificacion = async (\r\n  calificacion: Omit<Calificacion, 'id' | 'created_at' | 'updated_at'>\r\n): Promise<Calificacion> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .insert(calificacion)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// actualizar calificación\r\nexport const updateCalificacion = async (\r\n  id: string,\r\n  calificacion: Partial<Omit<Calificacion, 'id' | 'created_at' | 'updated_at'>>\r\n): Promise<Calificacion> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .update(calificacion)\r\n    .eq('id', id)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// eliminar calificación\r\nexport const deleteCalificacion = async (id: string): Promise<void> => {\r\n  const { error } = await supabase\r\n    .from('calificaciones')\r\n    .delete()\r\n    .eq('id', id);\r\n\r\n  if (error) throw error;\r\n};\r\n\r\n// calcular promedio de un estudiante en una clase\r\nexport const getPromedioEstudianteClase = async (\r\n  estudianteId: string,\r\n  claseId: string\r\n): Promise<number> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select('nota, ponderacion')\r\n    .eq('estudiante_id', estudianteId)\r\n    .eq('clase_id', claseId);\r\n\r\n  if (error) throw error;\r\n  \r\n  if (!data || data.length === 0) return 0;\r\n\r\n  // calcular promedio ponderado\r\n  const totalPonderacion = data.reduce((sum, cal) => sum + (cal.ponderacion || 100), 0);\r\n  const sumaNotas = data.reduce((sum, cal) => sum + (cal.nota * (cal.ponderacion || 100)), 0);\r\n  \r\n  return parseFloat((sumaNotas / totalPonderacion).toFixed(1));\r\n};\r\n\r\n// obtener promedio general del estudiante\r\nexport const getPromedioGeneralEstudiante = async (\r\n  estudianteId: string\r\n): Promise<number> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select('nota')\r\n    .eq('estudiante_id', estudianteId);\r\n\r\n  if (error) throw error;\r\n  \r\n  if (!data || data.length === 0) return 0;\r\n\r\n  const promedio = data.reduce((sum, cal) => sum + cal.nota, 0) / data.length;\r\n  return parseFloat(promedio.toFixed(1));\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}