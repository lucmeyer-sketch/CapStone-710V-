{"ast":null,"code":"import { supabase } from '../supabaseClient';\n// generar ID Ãºnico para notificaciones\nconst generarId = () => `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n// obtener estadÃ­sticas del dashboard\nexport const getEstadisticasDashboard = async () => {\n  try {\n    // total estudiantes\n    const {\n      count: totalEstudiantes\n    } = await supabase.from('Estudiantes').select('*', {\n      count: 'exact',\n      head: true\n    });\n\n    // total docentes\n    const {\n      count: totalDocentes\n    } = await supabase.from('docentes').select('*', {\n      count: 'exact',\n      head: true\n    });\n\n    // calcular tasa de asistencia (Ãºltimos 30 dÃ­as)\n    const hace30Dias = new Date();\n    hace30Dias.setDate(hace30Dias.getDate() - 30);\n    const {\n      data: asistencias\n    } = await supabase.from('asistencia').select('estado').gte('fecha', hace30Dias.toISOString().split('T')[0]);\n    let tasaAsistencia = 0;\n    if (asistencias && asistencias.length > 0) {\n      const presentes = asistencias.filter(a => a.estado === 'presente').length;\n      tasaAsistencia = presentes / asistencias.length * 100;\n    }\n\n    // promedio general de calificaciones\n    const {\n      data: calificaciones\n    } = await supabase.from('calificaciones').select('nota');\n    let promedioGeneral = 0;\n    if (calificaciones && calificaciones.length > 0) {\n      const suma = calificaciones.reduce((acc, c) => acc + (c.nota || 0), 0);\n      promedioGeneral = suma / calificaciones.length;\n    }\n\n    // usuarios activos (con sesiÃ³n en las Ãºltimas 24 horas)\n    const {\n      count: usuariosActivos\n    } = await supabase.from('usuarios').select('*', {\n      count: 'exact',\n      head: true\n    }).eq('activo', true);\n\n    // mensajes no leÃ­dos\n    const {\n      count: mensajesNoLeidos\n    } = await supabase.from('mensajes').select('*', {\n      count: 'exact',\n      head: true\n    }).eq('leido', false);\n\n    // reportes generados\n    const {\n      count: reportesGenerados\n    } = await supabase.from('reportes').select('*', {\n      count: 'exact',\n      head: true\n    });\n\n    // clases hoy\n    const hoy = new Date().toISOString().split('T')[0];\n    const diaSemana = new Date().getDay(); // 0 = domingo, 1 = lunes, etc.\n\n    const {\n      count: clasesHoy\n    } = await supabase.from('clases').select('*', {\n      count: 'exact',\n      head: true\n    }).eq('dia_semana', diaSemana);\n    return {\n      totalEstudiantes: totalEstudiantes || 0,\n      totalDocentes: totalDocentes || 0,\n      tasaAsistencia: Math.round(tasaAsistencia * 10) / 10,\n      promedioGeneral: Math.round(promedioGeneral * 10) / 10,\n      usuariosActivos: usuariosActivos || 0,\n      mensajesNoLeidos: mensajesNoLeidos || 0,\n      reportesGenerados: reportesGenerados || 0,\n      clasesHoy: clasesHoy || 0\n    };\n  } catch (error) {\n    console.error('Error al obtener estadÃ­sticas:', error);\n    throw error;\n  }\n};\n\n// obtener notificaciones recientes (simuladas por ahora)\nexport const getNotificacionesRecientes = async (limite = 10) => {\n  const notificaciones = [];\n  try {\n    // notificaciones de asistencia reciente\n    const {\n      data: asistenciasRecientes\n    } = await supabase.from('asistencia').select(`\n        *,\n        estudiante:Estudiantes(nombre, apellido)\n      `).order('created_at', {\n      ascending: false\n    }).limit(3);\n    if (asistenciasRecientes) {\n      asistenciasRecientes.forEach(asistencia => {\n        var _asistencia$estudiant, _asistencia$estudiant2;\n        const estudiante = `${(_asistencia$estudiant = asistencia.estudiante) === null || _asistencia$estudiant === void 0 ? void 0 : _asistencia$estudiant.nombre} ${(_asistencia$estudiant2 = asistencia.estudiante) === null || _asistencia$estudiant2 === void 0 ? void 0 : _asistencia$estudiant2.apellido}`;\n        if (asistencia.estado === 'ausente') {\n          notificaciones.push({\n            id: generarId(),\n            tipo: 'warning',\n            titulo: 'Ausencia Registrada',\n            mensaje: `${estudiante} fue marcado ausente`,\n            icono: 'âš ï¸',\n            timestamp: new Date(asistencia.created_at || Date.now()),\n            leida: false,\n            accion: {\n              texto: 'Ver Detalles',\n              link: '/attendance'\n            },\n            metadata: {\n              tabla: 'asistencia',\n              tipo_cambio: 'ausencia',\n              detalles: asistencia\n            }\n          });\n        } else if (asistencia.estado === 'presente') {\n          notificaciones.push({\n            id: generarId(),\n            tipo: 'success',\n            titulo: 'Asistencia Registrada',\n            mensaje: `${estudiante} asistiÃ³ a clase`,\n            icono: 'âœ…',\n            timestamp: new Date(asistencia.created_at || Date.now()),\n            leida: false,\n            metadata: {\n              tabla: 'asistencia',\n              tipo_cambio: 'presente',\n              detalles: asistencia\n            }\n          });\n        }\n      });\n    }\n\n    // notificaciones de calificaciones recientes\n    const {\n      data: calificacionesRecientes\n    } = await supabase.from('calificaciones').select(`\n        *,\n        estudiante:Estudiantes(nombre, apellido)\n      `).order('created_at', {\n      ascending: false\n    }).limit(3);\n    if (calificacionesRecientes) {\n      calificacionesRecientes.forEach(calif => {\n        var _calif$estudiante, _calif$estudiante2;\n        const estudiante = `${(_calif$estudiante = calif.estudiante) === null || _calif$estudiante === void 0 ? void 0 : _calif$estudiante.nombre} ${(_calif$estudiante2 = calif.estudiante) === null || _calif$estudiante2 === void 0 ? void 0 : _calif$estudiante2.apellido}`;\n        const calificacion = calif.calificacion;\n        let tipo = 'success';\n        let icono = 'ðŸ“';\n        if (calificacion >= 90) {\n          tipo = 'success';\n          icono = 'ðŸŒŸ';\n        } else if (calificacion >= 70) {\n          tipo = 'info';\n          icono = 'ðŸ“';\n        } else if (calificacion >= 50) {\n          tipo = 'warning';\n          icono = 'âš ï¸';\n        } else {\n          tipo = 'error';\n          icono = 'ðŸ”´';\n        }\n        notificaciones.push({\n          id: generarId(),\n          tipo,\n          titulo: 'CalificaciÃ³n Actualizada',\n          mensaje: `${estudiante} obtuvo ${calificacion} puntos`,\n          icono,\n          timestamp: new Date(calif.created_at || Date.now()),\n          leida: false,\n          accion: {\n            texto: 'Ver Calificaciones',\n            link: '/students'\n          },\n          metadata: {\n            tabla: 'calificaciones',\n            tipo_cambio: 'nueva_calificacion',\n            detalles: calif\n          }\n        });\n      });\n    }\n\n    // notificaciones de mensajes recientes\n    const {\n      data: mensajesRecientes\n    } = await supabase.from('mensajes').select('*').eq('leido', false).order('created_at', {\n      ascending: false\n    }).limit(3);\n    if (mensajesRecientes) {\n      mensajesRecientes.forEach(mensaje => {\n        let tipo = 'info';\n        let icono = 'ðŸ’¬';\n        if (mensaje.tipo === 'urgente') {\n          tipo = 'urgente';\n          icono = 'ðŸš¨';\n        } else if (mensaje.tipo === 'conductual') {\n          tipo = 'warning';\n          icono = 'âš ï¸';\n        }\n        notificaciones.push({\n          id: generarId(),\n          tipo,\n          titulo: `Mensaje ${mensaje.tipo}: ${mensaje.asunto}`,\n          mensaje: mensaje.mensaje.substring(0, 80) + (mensaje.mensaje.length > 80 ? '...' : ''),\n          icono,\n          timestamp: new Date(mensaje.created_at || Date.now()),\n          leida: false,\n          accion: {\n            texto: 'Ver Mensaje',\n            link: '/messages'\n          },\n          metadata: {\n            tabla: 'mensajes',\n            tipo_cambio: 'nuevo_mensaje',\n            detalles: mensaje\n          }\n        });\n      });\n    }\n\n    // notificaciones de reportes recientes\n    const {\n      data: reportesRecientes\n    } = await supabase.from('reportes').select('*').order('created_at', {\n      ascending: false\n    }).limit(2);\n    if (reportesRecientes) {\n      reportesRecientes.forEach(reporte => {\n        notificaciones.push({\n          id: generarId(),\n          tipo: 'info',\n          titulo: 'Reporte Generado',\n          mensaje: `${reporte.titulo} - ${reporte.tipo_reporte}`,\n          icono: 'ðŸ“Š',\n          timestamp: new Date(reporte.created_at || Date.now()),\n          leida: false,\n          accion: {\n            texto: 'Ver Reporte',\n            link: '/reports'\n          },\n          metadata: {\n            tabla: 'reportes',\n            tipo_cambio: 'nuevo_reporte',\n            detalles: reporte\n          }\n        });\n      });\n    }\n\n    // ordenar por timestamp descendente\n    notificaciones.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\n    return notificaciones.slice(0, limite);\n  } catch (error) {\n    console.error('Error al obtener notificaciones:', error);\n    return [];\n  }\n};\n\n// suscribirse a cambios en tiempo real\nexport const suscribirseACambios = onNuevaNotificacion => {\n  // suscripciÃ³n a cambios en asistencia\n  const asistenciaSubscription = supabase.channel('asistencia-changes').on('postgres_changes', {\n    event: '*',\n    schema: 'public',\n    table: 'asistencia'\n  }, async payload => {\n    console.log('Cambio en asistencia:', payload);\n\n    // obtener detalles del estudiante\n    if (payload.new && 'estudiante_id' in payload.new) {\n      const {\n        data: estudiante\n      } = await supabase.from('Estudiantes').select('nombre, apellido').eq('id', payload.new.estudiante_id).single();\n      if (estudiante) {\n        const nombreCompleto = `${estudiante.nombre} ${estudiante.apellido}`;\n        let tipo = 'success';\n        let titulo = 'Asistencia Registrada';\n        let icono = 'âœ…';\n        if (payload.new.estado === 'ausente') {\n          tipo = 'warning';\n          titulo = 'Ausencia Registrada';\n          icono = 'âš ï¸';\n        }\n        onNuevaNotificacion({\n          id: generarId(),\n          tipo,\n          titulo,\n          mensaje: `${nombreCompleto} - ${payload.new.estado}`,\n          icono,\n          timestamp: new Date(),\n          leida: false,\n          accion: {\n            texto: 'Ver Detalles',\n            link: '/attendance'\n          },\n          metadata: {\n            tabla: 'asistencia',\n            tipo_cambio: payload.eventType,\n            detalles: payload.new\n          }\n        });\n      }\n    }\n  }).subscribe();\n\n  // suscripciÃ³n a cambios en calificaciones\n  const calificacionesSubscription = supabase.channel('calificaciones-changes').on('postgres_changes', {\n    event: '*',\n    schema: 'public',\n    table: 'calificaciones'\n  }, async payload => {\n    console.log('Cambio en calificaciones:', payload);\n    if (payload.new && 'estudiante_id' in payload.new) {\n      const {\n        data: estudiante\n      } = await supabase.from('Estudiantes').select('nombre, apellido').eq('id', payload.new.estudiante_id).single();\n      if (estudiante) {\n        const nombreCompleto = `${estudiante.nombre} ${estudiante.apellido}`;\n        const calificacion = payload.new.calificacion;\n        let tipo = 'success';\n        let icono = 'ðŸ“';\n        if (calificacion >= 90) {\n          tipo = 'success';\n          icono = 'ðŸŒŸ';\n        } else if (calificacion < 50) {\n          tipo = 'error';\n          icono = 'ðŸ”´';\n        } else if (calificacion < 70) {\n          tipo = 'warning';\n          icono = 'âš ï¸';\n        }\n        onNuevaNotificacion({\n          id: generarId(),\n          tipo,\n          titulo: 'CalificaciÃ³n Actualizada',\n          mensaje: `${nombreCompleto} obtuvo ${calificacion} puntos`,\n          icono,\n          timestamp: new Date(),\n          leida: false,\n          accion: {\n            texto: 'Ver Calificaciones',\n            link: '/students'\n          },\n          metadata: {\n            tabla: 'calificaciones',\n            tipo_cambio: payload.eventType,\n            detalles: payload.new\n          }\n        });\n      }\n    }\n  }).subscribe();\n\n  // suscripciÃ³n a mensajes nuevos\n  const mensajesSubscription = supabase.channel('mensajes-changes').on('postgres_changes', {\n    event: 'INSERT',\n    schema: 'public',\n    table: 'mensajes'\n  }, payload => {\n    console.log('Nuevo mensaje:', payload);\n    if (payload.new) {\n      let tipo = 'info';\n      let icono = 'ðŸ’¬';\n      if (payload.new.tipo === 'urgente') {\n        tipo = 'urgente';\n        icono = 'ðŸš¨';\n      } else if (payload.new.tipo === 'conductual') {\n        tipo = 'warning';\n        icono = 'âš ï¸';\n      }\n      onNuevaNotificacion({\n        id: generarId(),\n        tipo,\n        titulo: `Mensaje ${payload.new.tipo}: ${payload.new.asunto}`,\n        mensaje: payload.new.mensaje.substring(0, 80) + '...',\n        icono,\n        timestamp: new Date(),\n        leida: false,\n        accion: {\n          texto: 'Ver Mensaje',\n          link: '/messages'\n        },\n        metadata: {\n          tabla: 'mensajes',\n          tipo_cambio: 'INSERT',\n          detalles: payload.new\n        }\n      });\n    }\n  }).subscribe();\n\n  // retornar funciÃ³n para desuscribirse\n  return () => {\n    asistenciaSubscription.unsubscribe();\n    calificacionesSubscription.unsubscribe();\n    mensajesSubscription.unsubscribe();\n  };\n};","map":{"version":3,"names":["supabase","generarId","Date","now","Math","random","toString","substr","getEstadisticasDashboard","count","totalEstudiantes","from","select","head","totalDocentes","hace30Dias","setDate","getDate","data","asistencias","gte","toISOString","split","tasaAsistencia","length","presentes","filter","a","estado","calificaciones","promedioGeneral","suma","reduce","acc","c","nota","usuariosActivos","eq","mensajesNoLeidos","reportesGenerados","hoy","diaSemana","getDay","clasesHoy","round","error","console","getNotificacionesRecientes","limite","notificaciones","asistenciasRecientes","order","ascending","limit","forEach","asistencia","_asistencia$estudiant","_asistencia$estudiant2","estudiante","nombre","apellido","push","id","tipo","titulo","mensaje","icono","timestamp","created_at","leida","accion","texto","link","metadata","tabla","tipo_cambio","detalles","calificacionesRecientes","calif","_calif$estudiante","_calif$estudiante2","calificacion","mensajesRecientes","asunto","substring","reportesRecientes","reporte","tipo_reporte","sort","b","getTime","slice","suscribirseACambios","onNuevaNotificacion","asistenciaSubscription","channel","on","event","schema","table","payload","log","new","estudiante_id","single","nombreCompleto","eventType","subscribe","calificacionesSubscription","mensajesSubscription","unsubscribe"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/Proyecto/src/services/notificationService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\r\n\r\nexport interface Notificacion {\r\n  id: string;\r\n  tipo: 'info' | 'success' | 'warning' | 'error' | 'urgente';\r\n  titulo: string;\r\n  mensaje: string;\r\n  icono: string;\r\n  timestamp: Date;\r\n  leida: boolean;\r\n  accion?: {\r\n    texto: string;\r\n    link: string;\r\n  };\r\n  metadata?: {\r\n    tabla: string;\r\n    tipo_cambio: string;\r\n    usuario?: string;\r\n    detalles?: any;\r\n  };\r\n}\r\n\r\nexport interface EstadisticasDashboard {\r\n  totalEstudiantes: number;\r\n  totalDocentes: number;\r\n  tasaAsistencia: number;\r\n  promedioGeneral: number;\r\n  usuariosActivos: number;\r\n  mensajesNoLeidos: number;\r\n  reportesGenerados: number;\r\n  clasesHoy: number;\r\n}\r\n\r\n// generar ID Ãºnico para notificaciones\r\nconst generarId = () => `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n// obtener estadÃ­sticas del dashboard\r\nexport const getEstadisticasDashboard = async (): Promise<EstadisticasDashboard> => {\r\n  try {\r\n    // total estudiantes\r\n    const { count: totalEstudiantes } = await supabase\r\n      .from('Estudiantes')\r\n      .select('*', { count: 'exact', head: true });\r\n\r\n    // total docentes\r\n    const { count: totalDocentes } = await supabase\r\n      .from('docentes')\r\n      .select('*', { count: 'exact', head: true });\r\n\r\n    // calcular tasa de asistencia (Ãºltimos 30 dÃ­as)\r\n    const hace30Dias = new Date();\r\n    hace30Dias.setDate(hace30Dias.getDate() - 30);\r\n    \r\n    const { data: asistencias } = await supabase\r\n      .from('asistencia')\r\n      .select('estado')\r\n      .gte('fecha', hace30Dias.toISOString().split('T')[0]);\r\n\r\n    let tasaAsistencia = 0;\r\n    if (asistencias && asistencias.length > 0) {\r\n      const presentes = asistencias.filter(a => a.estado === 'presente').length;\r\n      tasaAsistencia = (presentes / asistencias.length) * 100;\r\n    }\r\n\r\n    // promedio general de calificaciones\r\n    const { data: calificaciones } = await supabase\r\n      .from('calificaciones')\r\n      .select('nota');\r\n\r\n    let promedioGeneral = 0;\r\n    if (calificaciones && calificaciones.length > 0) {\r\n      const suma = calificaciones.reduce((acc, c) => acc + (c.nota || 0), 0);\r\n      promedioGeneral = suma / calificaciones.length;\r\n    }\r\n\r\n    // usuarios activos (con sesiÃ³n en las Ãºltimas 24 horas)\r\n    const { count: usuariosActivos } = await supabase\r\n      .from('usuarios')\r\n      .select('*', { count: 'exact', head: true })\r\n      .eq('activo', true);\r\n\r\n    // mensajes no leÃ­dos\r\n    const { count: mensajesNoLeidos } = await supabase\r\n      .from('mensajes')\r\n      .select('*', { count: 'exact', head: true })\r\n      .eq('leido', false);\r\n\r\n    // reportes generados\r\n    const { count: reportesGenerados } = await supabase\r\n      .from('reportes')\r\n      .select('*', { count: 'exact', head: true });\r\n\r\n    // clases hoy\r\n    const hoy = new Date().toISOString().split('T')[0];\r\n    const diaSemana = new Date().getDay(); // 0 = domingo, 1 = lunes, etc.\r\n    \r\n    const { count: clasesHoy } = await supabase\r\n      .from('clases')\r\n      .select('*', { count: 'exact', head: true })\r\n      .eq('dia_semana', diaSemana);\r\n\r\n    return {\r\n      totalEstudiantes: totalEstudiantes || 0,\r\n      totalDocentes: totalDocentes || 0,\r\n      tasaAsistencia: Math.round(tasaAsistencia * 10) / 10,\r\n      promedioGeneral: Math.round(promedioGeneral * 10) / 10,\r\n      usuariosActivos: usuariosActivos || 0,\r\n      mensajesNoLeidos: mensajesNoLeidos || 0,\r\n      reportesGenerados: reportesGenerados || 0,\r\n      clasesHoy: clasesHoy || 0\r\n    };\r\n  } catch (error) {\r\n    console.error('Error al obtener estadÃ­sticas:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n// obtener notificaciones recientes (simuladas por ahora)\r\nexport const getNotificacionesRecientes = async (limite: number = 10): Promise<Notificacion[]> => {\r\n  const notificaciones: Notificacion[] = [];\r\n\r\n  try {\r\n    // notificaciones de asistencia reciente\r\n    const { data: asistenciasRecientes } = await supabase\r\n      .from('asistencia')\r\n      .select(`\r\n        *,\r\n        estudiante:Estudiantes(nombre, apellido)\r\n      `)\r\n      .order('created_at', { ascending: false })\r\n      .limit(3);\r\n\r\n    if (asistenciasRecientes) {\r\n      asistenciasRecientes.forEach(asistencia => {\r\n        const estudiante = `${asistencia.estudiante?.nombre} ${asistencia.estudiante?.apellido}`;\r\n        \r\n        if (asistencia.estado === 'ausente') {\r\n          notificaciones.push({\r\n            id: generarId(),\r\n            tipo: 'warning',\r\n            titulo: 'Ausencia Registrada',\r\n            mensaje: `${estudiante} fue marcado ausente`,\r\n            icono: 'âš ï¸',\r\n            timestamp: new Date(asistencia.created_at || Date.now()),\r\n            leida: false,\r\n            accion: {\r\n              texto: 'Ver Detalles',\r\n              link: '/attendance'\r\n            },\r\n            metadata: {\r\n              tabla: 'asistencia',\r\n              tipo_cambio: 'ausencia',\r\n              detalles: asistencia\r\n            }\r\n          });\r\n        } else if (asistencia.estado === 'presente') {\r\n          notificaciones.push({\r\n            id: generarId(),\r\n            tipo: 'success',\r\n            titulo: 'Asistencia Registrada',\r\n            mensaje: `${estudiante} asistiÃ³ a clase`,\r\n            icono: 'âœ…',\r\n            timestamp: new Date(asistencia.created_at || Date.now()),\r\n            leida: false,\r\n            metadata: {\r\n              tabla: 'asistencia',\r\n              tipo_cambio: 'presente',\r\n              detalles: asistencia\r\n            }\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    // notificaciones de calificaciones recientes\r\n    const { data: calificacionesRecientes } = await supabase\r\n      .from('calificaciones')\r\n      .select(`\r\n        *,\r\n        estudiante:Estudiantes(nombre, apellido)\r\n      `)\r\n      .order('created_at', { ascending: false })\r\n      .limit(3);\r\n\r\n    if (calificacionesRecientes) {\r\n      calificacionesRecientes.forEach(calif => {\r\n        const estudiante = `${calif.estudiante?.nombre} ${calif.estudiante?.apellido}`;\r\n        const calificacion = calif.calificacion;\r\n        \r\n        let tipo: 'info' | 'success' | 'warning' | 'error' = 'success';\r\n        let icono = 'ðŸ“';\r\n        \r\n        if (calificacion >= 90) {\r\n          tipo = 'success';\r\n          icono = 'ðŸŒŸ';\r\n        } else if (calificacion >= 70) {\r\n          tipo = 'info';\r\n          icono = 'ðŸ“';\r\n        } else if (calificacion >= 50) {\r\n          tipo = 'warning';\r\n          icono = 'âš ï¸';\r\n        } else {\r\n          tipo = 'error';\r\n          icono = 'ðŸ”´';\r\n        }\r\n\r\n        notificaciones.push({\r\n          id: generarId(),\r\n          tipo,\r\n          titulo: 'CalificaciÃ³n Actualizada',\r\n          mensaje: `${estudiante} obtuvo ${calificacion} puntos`,\r\n          icono,\r\n          timestamp: new Date(calif.created_at || Date.now()),\r\n          leida: false,\r\n          accion: {\r\n            texto: 'Ver Calificaciones',\r\n            link: '/students'\r\n          },\r\n          metadata: {\r\n            tabla: 'calificaciones',\r\n            tipo_cambio: 'nueva_calificacion',\r\n            detalles: calif\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // notificaciones de mensajes recientes\r\n    const { data: mensajesRecientes } = await supabase\r\n      .from('mensajes')\r\n      .select('*')\r\n      .eq('leido', false)\r\n      .order('created_at', { ascending: false })\r\n      .limit(3);\r\n\r\n    if (mensajesRecientes) {\r\n      mensajesRecientes.forEach(mensaje => {\r\n        let tipo: 'info' | 'warning' | 'urgente' = 'info';\r\n        let icono = 'ðŸ’¬';\r\n\r\n        if (mensaje.tipo === 'urgente') {\r\n          tipo = 'urgente';\r\n          icono = 'ðŸš¨';\r\n        } else if (mensaje.tipo === 'conductual') {\r\n          tipo = 'warning';\r\n          icono = 'âš ï¸';\r\n        }\r\n\r\n        notificaciones.push({\r\n          id: generarId(),\r\n          tipo,\r\n          titulo: `Mensaje ${mensaje.tipo}: ${mensaje.asunto}`,\r\n          mensaje: mensaje.mensaje.substring(0, 80) + (mensaje.mensaje.length > 80 ? '...' : ''),\r\n          icono,\r\n          timestamp: new Date(mensaje.created_at || Date.now()),\r\n          leida: false,\r\n          accion: {\r\n            texto: 'Ver Mensaje',\r\n            link: '/messages'\r\n          },\r\n          metadata: {\r\n            tabla: 'mensajes',\r\n            tipo_cambio: 'nuevo_mensaje',\r\n            detalles: mensaje\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // notificaciones de reportes recientes\r\n    const { data: reportesRecientes } = await supabase\r\n      .from('reportes')\r\n      .select('*')\r\n      .order('created_at', { ascending: false })\r\n      .limit(2);\r\n\r\n    if (reportesRecientes) {\r\n      reportesRecientes.forEach(reporte => {\r\n        notificaciones.push({\r\n          id: generarId(),\r\n          tipo: 'info',\r\n          titulo: 'Reporte Generado',\r\n          mensaje: `${reporte.titulo} - ${reporte.tipo_reporte}`,\r\n          icono: 'ðŸ“Š',\r\n          timestamp: new Date(reporte.created_at || Date.now()),\r\n          leida: false,\r\n          accion: {\r\n            texto: 'Ver Reporte',\r\n            link: '/reports'\r\n          },\r\n          metadata: {\r\n            tabla: 'reportes',\r\n            tipo_cambio: 'nuevo_reporte',\r\n            detalles: reporte\r\n          }\r\n        });\r\n      });\r\n    }\r\n\r\n    // ordenar por timestamp descendente\r\n    notificaciones.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());\r\n\r\n    return notificaciones.slice(0, limite);\r\n  } catch (error) {\r\n    console.error('Error al obtener notificaciones:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// suscribirse a cambios en tiempo real\r\nexport const suscribirseACambios = (\r\n  onNuevaNotificacion: (notificacion: Notificacion) => void\r\n) => {\r\n  // suscripciÃ³n a cambios en asistencia\r\n  const asistenciaSubscription = supabase\r\n    .channel('asistencia-changes')\r\n    .on(\r\n      'postgres_changes',\r\n      { event: '*', schema: 'public', table: 'asistencia' },\r\n      async (payload) => {\r\n        console.log('Cambio en asistencia:', payload);\r\n        \r\n        // obtener detalles del estudiante\r\n        if (payload.new && 'estudiante_id' in payload.new) {\r\n          const { data: estudiante } = await supabase\r\n            .from('Estudiantes')\r\n            .select('nombre, apellido')\r\n            .eq('id', payload.new.estudiante_id)\r\n            .single();\r\n\r\n          if (estudiante) {\r\n            const nombreCompleto = `${estudiante.nombre} ${estudiante.apellido}`;\r\n            let tipo: 'success' | 'warning' = 'success';\r\n            let titulo = 'Asistencia Registrada';\r\n            let icono = 'âœ…';\r\n\r\n            if (payload.new.estado === 'ausente') {\r\n              tipo = 'warning';\r\n              titulo = 'Ausencia Registrada';\r\n              icono = 'âš ï¸';\r\n            }\r\n\r\n            onNuevaNotificacion({\r\n              id: generarId(),\r\n              tipo,\r\n              titulo,\r\n              mensaje: `${nombreCompleto} - ${payload.new.estado}`,\r\n              icono,\r\n              timestamp: new Date(),\r\n              leida: false,\r\n              accion: {\r\n                texto: 'Ver Detalles',\r\n                link: '/attendance'\r\n              },\r\n              metadata: {\r\n                tabla: 'asistencia',\r\n                tipo_cambio: payload.eventType,\r\n                detalles: payload.new\r\n              }\r\n            });\r\n          }\r\n        }\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  // suscripciÃ³n a cambios en calificaciones\r\n  const calificacionesSubscription = supabase\r\n    .channel('calificaciones-changes')\r\n    .on(\r\n      'postgres_changes',\r\n      { event: '*', schema: 'public', table: 'calificaciones' },\r\n      async (payload) => {\r\n        console.log('Cambio en calificaciones:', payload);\r\n        \r\n        if (payload.new && 'estudiante_id' in payload.new) {\r\n          const { data: estudiante } = await supabase\r\n            .from('Estudiantes')\r\n            .select('nombre, apellido')\r\n            .eq('id', payload.new.estudiante_id)\r\n            .single();\r\n\r\n          if (estudiante) {\r\n            const nombreCompleto = `${estudiante.nombre} ${estudiante.apellido}`;\r\n            const calificacion = payload.new.calificacion;\r\n            \r\n            let tipo: 'success' | 'warning' | 'error' = 'success';\r\n            let icono = 'ðŸ“';\r\n            \r\n            if (calificacion >= 90) {\r\n              tipo = 'success';\r\n              icono = 'ðŸŒŸ';\r\n            } else if (calificacion < 50) {\r\n              tipo = 'error';\r\n              icono = 'ðŸ”´';\r\n            } else if (calificacion < 70) {\r\n              tipo = 'warning';\r\n              icono = 'âš ï¸';\r\n            }\r\n\r\n            onNuevaNotificacion({\r\n              id: generarId(),\r\n              tipo,\r\n              titulo: 'CalificaciÃ³n Actualizada',\r\n              mensaje: `${nombreCompleto} obtuvo ${calificacion} puntos`,\r\n              icono,\r\n              timestamp: new Date(),\r\n              leida: false,\r\n              accion: {\r\n                texto: 'Ver Calificaciones',\r\n                link: '/students'\r\n              },\r\n              metadata: {\r\n                tabla: 'calificaciones',\r\n                tipo_cambio: payload.eventType,\r\n                detalles: payload.new\r\n              }\r\n            });\r\n          }\r\n        }\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  // suscripciÃ³n a mensajes nuevos\r\n  const mensajesSubscription = supabase\r\n    .channel('mensajes-changes')\r\n    .on(\r\n      'postgres_changes',\r\n      { event: 'INSERT', schema: 'public', table: 'mensajes' },\r\n      (payload) => {\r\n        console.log('Nuevo mensaje:', payload);\r\n        \r\n        if (payload.new) {\r\n          let tipo: 'info' | 'warning' | 'urgente' = 'info';\r\n          let icono = 'ðŸ’¬';\r\n\r\n          if (payload.new.tipo === 'urgente') {\r\n            tipo = 'urgente';\r\n            icono = 'ðŸš¨';\r\n          } else if (payload.new.tipo === 'conductual') {\r\n            tipo = 'warning';\r\n            icono = 'âš ï¸';\r\n          }\r\n\r\n          onNuevaNotificacion({\r\n            id: generarId(),\r\n            tipo,\r\n            titulo: `Mensaje ${payload.new.tipo}: ${payload.new.asunto}`,\r\n            mensaje: payload.new.mensaje.substring(0, 80) + '...',\r\n            icono,\r\n            timestamp: new Date(),\r\n            leida: false,\r\n            accion: {\r\n              texto: 'Ver Mensaje',\r\n              link: '/messages'\r\n            },\r\n            metadata: {\r\n              tabla: 'mensajes',\r\n              tipo_cambio: 'INSERT',\r\n              detalles: payload.new\r\n            }\r\n          });\r\n        }\r\n      }\r\n    )\r\n    .subscribe();\r\n\r\n  // retornar funciÃ³n para desuscribirse\r\n  return () => {\r\n    asistenciaSubscription.unsubscribe();\r\n    calificacionesSubscription.unsubscribe();\r\n    mensajesSubscription.unsubscribe();\r\n  };\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}