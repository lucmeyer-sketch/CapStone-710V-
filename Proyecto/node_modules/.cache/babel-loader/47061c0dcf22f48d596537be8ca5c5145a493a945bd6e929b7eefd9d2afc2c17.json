{"ast":null,"code":"import { supabase } from '../supabaseClient';\n// obtener todas las calificaciones de un estudiante\nexport const getCalificacionesByEstudiante = async estudianteId => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select(`\n      *,\n      clase:clases (\n        *,\n        materia:materias (*),\n        docente:docentes (*)\n      )\n    `).eq('estudiante_id', estudianteId).order('fecha_evaluacion', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// obtener calificaciones por clase\nexport const getCalificacionesByClase = async claseId => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select(`\n      *,\n      estudiante:Estudiantes (\n        nombre,\n        apellido,\n        grado,\n        seccion\n      )\n    `).eq('clase_id', claseId).order('fecha_evaluacion', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// crear calificación\nexport const createCalificacion = async calificacion => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').insert(calificacion).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// actualizar calificación\nexport const updateCalificacion = async (id, calificacion) => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').update(calificacion).eq('id', id).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// eliminar calificación\nexport const deleteCalificacion = async id => {\n  const {\n    error\n  } = await supabase.from('calificaciones').delete().eq('id', id);\n  if (error) throw error;\n};\n\n// calcular promedio de un estudiante en una clase\nexport const getPromedioEstudianteClase = async (estudianteId, claseId) => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select('nota, ponderacion').eq('estudiante_id', estudianteId).eq('clase_id', claseId);\n  if (error) throw error;\n  if (!data || data.length === 0) return 0;\n\n  // calcular promedio ponderado\n  const totalPonderacion = data.reduce((sum, cal) => sum + (cal.ponderacion || 100), 0);\n  const sumaNotas = data.reduce((sum, cal) => sum + cal.nota * (cal.ponderacion || 100), 0);\n  return parseFloat((sumaNotas / totalPonderacion).toFixed(1));\n};\n\n// obtener promedio general del estudiante\nexport const getPromedioGeneralEstudiante = async estudianteId => {\n  const {\n    data,\n    error\n  } = await supabase.from('calificaciones').select('nota').eq('estudiante_id', estudianteId);\n  if (error) throw error;\n  if (!data || data.length === 0) return 0;\n  const promedio = data.reduce((sum, cal) => sum + cal.nota, 0) / data.length;\n  return parseFloat(promedio.toFixed(1));\n};","map":{"version":3,"names":["supabase","getCalificacionesByEstudiante","estudianteId","data","error","from","select","eq","order","ascending","getCalificacionesByClase","claseId","createCalificacion","calificacion","insert","single","updateCalificacion","id","update","deleteCalificacion","delete","getPromedioEstudianteClase","length","totalPonderacion","reduce","sum","cal","ponderacion","sumaNotas","nota","parseFloat","toFixed","getPromedioGeneralEstudiante","promedio"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/Proyecto/src/services/calificacionService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\r\nimport { Calificacion, CalificacionConDetalles } from '../types/database';\r\n\r\n// obtener todas las calificaciones de un estudiante\r\nexport const getCalificacionesByEstudiante = async (\r\n  estudianteId: string\r\n): Promise<CalificacionConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select(`\r\n      *,\r\n      clase:clases (\r\n        *,\r\n        materia:materias (*),\r\n        docente:docentes (*)\r\n      )\r\n    `)\r\n    .eq('estudiante_id', estudianteId)\r\n    .order('fecha_evaluacion', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// obtener calificaciones por clase\r\nexport const getCalificacionesByClase = async (\r\n  claseId: string\r\n): Promise<CalificacionConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select(`\r\n      *,\r\n      estudiante:Estudiantes (\r\n        nombre,\r\n        apellido,\r\n        grado,\r\n        seccion\r\n      )\r\n    `)\r\n    .eq('clase_id', claseId)\r\n    .order('fecha_evaluacion', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// crear calificación\r\nexport const createCalificacion = async (\r\n  calificacion: Omit<Calificacion, 'id' | 'created_at' | 'updated_at'>\r\n): Promise<Calificacion> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .insert(calificacion)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// actualizar calificación\r\nexport const updateCalificacion = async (\r\n  id: string,\r\n  calificacion: Partial<Omit<Calificacion, 'id' | 'created_at' | 'updated_at'>>\r\n): Promise<Calificacion> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .update(calificacion)\r\n    .eq('id', id)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// eliminar calificación\r\nexport const deleteCalificacion = async (id: string): Promise<void> => {\r\n  const { error } = await supabase\r\n    .from('calificaciones')\r\n    .delete()\r\n    .eq('id', id);\r\n\r\n  if (error) throw error;\r\n};\r\n\r\n// calcular promedio de un estudiante en una clase\r\nexport const getPromedioEstudianteClase = async (\r\n  estudianteId: string,\r\n  claseId: string\r\n): Promise<number> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select('nota, ponderacion')\r\n    .eq('estudiante_id', estudianteId)\r\n    .eq('clase_id', claseId);\r\n\r\n  if (error) throw error;\r\n  \r\n  if (!data || data.length === 0) return 0;\r\n\r\n  // calcular promedio ponderado\r\n  const totalPonderacion = data.reduce((sum, cal) => sum + (cal.ponderacion || 100), 0);\r\n  const sumaNotas = data.reduce((sum, cal) => sum + (cal.nota * (cal.ponderacion || 100)), 0);\r\n  \r\n  return parseFloat((sumaNotas / totalPonderacion).toFixed(1));\r\n};\r\n\r\n// obtener promedio general del estudiante\r\nexport const getPromedioGeneralEstudiante = async (\r\n  estudianteId: string\r\n): Promise<number> => {\r\n  const { data, error } = await supabase\r\n    .from('calificaciones')\r\n    .select('nota')\r\n    .eq('estudiante_id', estudianteId);\r\n\r\n  if (error) throw error;\r\n  \r\n  if (!data || data.length === 0) return 0;\r\n\r\n  const promedio = data.reduce((sum, cal) => sum + cal.nota, 0) / data.length;\r\n  return parseFloat(promedio.toFixed(1));\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}