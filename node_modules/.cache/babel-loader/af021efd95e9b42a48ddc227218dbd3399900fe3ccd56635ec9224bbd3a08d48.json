{"ast":null,"code":"import { supabase } from '../supabaseClient';\n// obtener toda la asistencia\nexport const getAllAsistencia = async () => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select(`\n      *,\n      estudiante:Estudiantes (\n        nombre,\n        apellido,\n        grado,\n        seccion\n      ),\n      clase:clases (\n        materia:materias (\n          nombre,\n          codigo\n        ),\n        docente:docentes (\n          nombre,\n          apellido\n        )\n      )\n    `).order('fecha', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// obtener asistencia por fecha\nexport const getAsistenciaByFecha = async fecha => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select(`\n      *,\n      estudiante:Estudiantes (\n        nombre,\n        apellido,\n        grado,\n        seccion\n      ),\n      clase:clases (\n        materia:materias (\n          nombre,\n          codigo\n        )\n      )\n    `).eq('fecha', fecha);\n  if (error) throw error;\n\n  // ordenar en el frontend por apellido del estudiante\n  const sorted = (data || []).sort((a, b) => {\n    var _a$estudiante, _b$estudiante;\n    const apellidoA = ((_a$estudiante = a.estudiante) === null || _a$estudiante === void 0 ? void 0 : _a$estudiante.apellido) || '';\n    const apellidoB = ((_b$estudiante = b.estudiante) === null || _b$estudiante === void 0 ? void 0 : _b$estudiante.apellido) || '';\n    return apellidoA.localeCompare(apellidoB);\n  });\n  return sorted;\n};\n\n// obtener asistencia por estudiante\nexport const getAsistenciaByEstudiante = async estudianteId => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select('*').eq('estudiante_id', estudianteId).order('fecha', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// obtener asistencia por clase y fecha\nexport const getAsistenciaByClaseFecha = async (claseId, fecha) => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select(`\n      *,\n      estudiante:Estudiantes (\n        nombre,\n        apellido,\n        grado,\n        seccion\n      )\n    `).eq('clase_id', claseId).eq('fecha', fecha).order('estudiante.apellido', {\n    ascending: true\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// crear o actualizar asistencia\nexport const upsertAsistencia = async asistencia => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').upsert({\n    estudiante_id: asistencia.estudiante_id,\n    clase_id: asistencia.clase_id,\n    fecha: asistencia.fecha,\n    estado: asistencia.estado,\n    hora_llegada: asistencia.hora_llegada,\n    observaciones: asistencia.observaciones\n  }, {\n    onConflict: 'estudiante_id,clase_id,fecha'\n  }).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// eliminar asistencia\nexport const deleteAsistencia = async id => {\n  const {\n    error\n  } = await supabase.from('asistencia').delete().eq('id', id);\n  if (error) throw error;\n};\n\n// obtener estadísticas de asistencia\nexport const getEstadisticasAsistencia = async (fechaInicio, fechaFin) => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select('estado').gte('fecha', fechaInicio).lte('fecha', fechaFin);\n  if (error) throw error;\n  const total = data.length;\n  const presente = data.filter(r => r.estado === 'presente').length;\n  const ausente = data.filter(r => r.estado === 'ausente').length;\n  const tarde = data.filter(r => r.estado === 'tarde').length;\n  const justificado = data.filter(r => r.estado === 'justificado').length;\n  return {\n    total,\n    presente,\n    ausente,\n    tarde,\n    justificado,\n    porcentajeAsistencia: total > 0 ? ((presente + tarde) / total * 100).toFixed(1) : '0'\n  };\n};\n\n// obtener porcentaje de asistencia de un estudiante\nexport const getPorcentajeAsistenciaEstudiante = async (estudianteId, fechaInicio, fechaFin) => {\n  const {\n    data,\n    error\n  } = await supabase.from('asistencia').select('estado').eq('estudiante_id', estudianteId).gte('fecha', fechaInicio).lte('fecha', fechaFin);\n  if (error) throw error;\n  if (!data || data.length === 0) return 100;\n  const total = data.length;\n  const presente = data.filter(r => r.estado === 'presente' || r.estado === 'tarde').length;\n  return parseFloat((presente / total * 100).toFixed(1));\n};","map":{"version":3,"names":["supabase","getAllAsistencia","data","error","from","select","order","ascending","getAsistenciaByFecha","fecha","eq","sorted","sort","a","b","_a$estudiante","_b$estudiante","apellidoA","estudiante","apellido","apellidoB","localeCompare","getAsistenciaByEstudiante","estudianteId","getAsistenciaByClaseFecha","claseId","upsertAsistencia","asistencia","upsert","estudiante_id","clase_id","estado","hora_llegada","observaciones","onConflict","single","deleteAsistencia","id","delete","getEstadisticasAsistencia","fechaInicio","fechaFin","gte","lte","total","length","presente","filter","r","ausente","tarde","justificado","porcentajeAsistencia","toFixed","getPorcentajeAsistenciaEstudiante","parseFloat"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/src/services/asistenciaService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\r\nimport { Asistencia, AsistenciaConDetalles } from '../types/database';\r\n\r\n// obtener toda la asistencia\r\nexport const getAllAsistencia = async (): Promise<AsistenciaConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select(`\r\n      *,\r\n      estudiante:Estudiantes (\r\n        nombre,\r\n        apellido,\r\n        grado,\r\n        seccion\r\n      ),\r\n      clase:clases (\r\n        materia:materias (\r\n          nombre,\r\n          codigo\r\n        ),\r\n        docente:docentes (\r\n          nombre,\r\n          apellido\r\n        )\r\n      )\r\n    `)\r\n    .order('fecha', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// obtener asistencia por fecha\r\nexport const getAsistenciaByFecha = async (\r\n  fecha: string\r\n): Promise<AsistenciaConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select(`\r\n      *,\r\n      estudiante:Estudiantes (\r\n        nombre,\r\n        apellido,\r\n        grado,\r\n        seccion\r\n      ),\r\n      clase:clases (\r\n        materia:materias (\r\n          nombre,\r\n          codigo\r\n        )\r\n      )\r\n    `)\r\n    .eq('fecha', fecha);\r\n\r\n  if (error) throw error;\r\n  \r\n  // ordenar en el frontend por apellido del estudiante\r\n  const sorted = (data || []).sort((a, b) => {\r\n    const apellidoA = a.estudiante?.apellido || '';\r\n    const apellidoB = b.estudiante?.apellido || '';\r\n    return apellidoA.localeCompare(apellidoB);\r\n  });\r\n  \r\n  return sorted;\r\n};\r\n\r\n// obtener asistencia por estudiante\r\nexport const getAsistenciaByEstudiante = async (\r\n  estudianteId: string\r\n): Promise<Asistencia[]> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select('*')\r\n    .eq('estudiante_id', estudianteId)\r\n    .order('fecha', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// obtener asistencia por clase y fecha\r\nexport const getAsistenciaByClaseFecha = async (\r\n  claseId: string,\r\n  fecha: string\r\n): Promise<AsistenciaConDetalles[]> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select(`\r\n      *,\r\n      estudiante:Estudiantes (\r\n        nombre,\r\n        apellido,\r\n        grado,\r\n        seccion\r\n      )\r\n    `)\r\n    .eq('clase_id', claseId)\r\n    .eq('fecha', fecha)\r\n    .order('estudiante.apellido', { ascending: true });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// crear o actualizar asistencia\r\nexport const upsertAsistencia = async (\r\n  asistencia: Omit<Asistencia, 'id' | 'created_at' | 'updated_at'>\r\n): Promise<Asistencia> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .upsert({\r\n      estudiante_id: asistencia.estudiante_id,\r\n      clase_id: asistencia.clase_id,\r\n      fecha: asistencia.fecha,\r\n      estado: asistencia.estado,\r\n      hora_llegada: asistencia.hora_llegada,\r\n      observaciones: asistencia.observaciones,\r\n    }, {\r\n      onConflict: 'estudiante_id,clase_id,fecha'\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// eliminar asistencia\r\nexport const deleteAsistencia = async (id: string): Promise<void> => {\r\n  const { error } = await supabase\r\n    .from('asistencia')\r\n    .delete()\r\n    .eq('id', id);\r\n\r\n  if (error) throw error;\r\n};\r\n\r\n// obtener estadísticas de asistencia\r\nexport const getEstadisticasAsistencia = async (\r\n  fechaInicio: string,\r\n  fechaFin: string\r\n) => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select('estado')\r\n    .gte('fecha', fechaInicio)\r\n    .lte('fecha', fechaFin);\r\n\r\n  if (error) throw error;\r\n\r\n  const total = data.length;\r\n  const presente = data.filter(r => r.estado === 'presente').length;\r\n  const ausente = data.filter(r => r.estado === 'ausente').length;\r\n  const tarde = data.filter(r => r.estado === 'tarde').length;\r\n  const justificado = data.filter(r => r.estado === 'justificado').length;\r\n\r\n  return {\r\n    total,\r\n    presente,\r\n    ausente,\r\n    tarde,\r\n    justificado,\r\n    porcentajeAsistencia: total > 0 ? ((presente + tarde) / total * 100).toFixed(1) : '0',\r\n  };\r\n};\r\n\r\n// obtener porcentaje de asistencia de un estudiante\r\nexport const getPorcentajeAsistenciaEstudiante = async (\r\n  estudianteId: string,\r\n  fechaInicio: string,\r\n  fechaFin: string\r\n): Promise<number> => {\r\n  const { data, error } = await supabase\r\n    .from('asistencia')\r\n    .select('estado')\r\n    .eq('estudiante_id', estudianteId)\r\n    .gte('fecha', fechaInicio)\r\n    .lte('fecha', fechaFin);\r\n\r\n  if (error) throw error;\r\n\r\n  if (!data || data.length === 0) return 100;\r\n\r\n  const total = data.length;\r\n  const presente = data.filter(r => r.estado === 'presente' || r.estado === 'tarde').length;\r\n\r\n  return parseFloat(((presente / total) * 100).toFixed(1));\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}