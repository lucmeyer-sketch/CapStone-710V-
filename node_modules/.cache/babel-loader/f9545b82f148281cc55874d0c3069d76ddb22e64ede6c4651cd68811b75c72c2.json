{"ast":null,"code":"import { supabase } from '../supabaseClient';\n// obtener todos los registros de asistencia\nexport const getAllAttendance = async () => {\n  const {\n    data,\n    error\n  } = await supabase.from('attendance_records').select(`\n      *,\n      student:students (\n        name,\n        last_name,\n        grade,\n        section\n      )\n    `).order('date', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// obtener asistencia por fecha\nexport const getAttendanceByDate = async date => {\n  const {\n    data,\n    error\n  } = await supabase.from('attendance_records').select(`\n      *,\n      student:students (\n        name,\n        last_name,\n        grade,\n        section\n      )\n    `).eq('date', date).order('student.last_name', {\n    ascending: true\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// obtener asistencia por estudiante\nexport const getAttendanceByStudent = async studentId => {\n  const {\n    data,\n    error\n  } = await supabase.from('attendance_records').select('*').eq('student_id', studentId).order('date', {\n    ascending: false\n  });\n  if (error) throw error;\n  return data || [];\n};\n\n// crear o actualizar registro de asistencia\nexport const upsertAttendance = async attendance => {\n  const {\n    data,\n    error\n  } = await supabase.from('attendance_records').upsert({\n    student_id: attendance.studentId,\n    date: attendance.date,\n    status: attendance.status,\n    notes: attendance.notes || null\n  }, {\n    onConflict: 'student_id,date'\n  }).select().single();\n  if (error) throw error;\n  return data;\n};\n\n// eliminar registro de asistencia\nexport const deleteAttendance = async id => {\n  const {\n    error\n  } = await supabase.from('attendance_records').delete().eq('id', id);\n  if (error) throw error;\n};\n\n// obtener estadísticas de asistencia\nexport const getAttendanceStats = async (startDate, endDate) => {\n  const {\n    data,\n    error\n  } = await supabase.from('attendance_records').select('status').gte('date', startDate).lte('date', endDate);\n  if (error) throw error;\n  const total = data.length;\n  const present = data.filter(r => r.status === 'present').length;\n  const absent = data.filter(r => r.status === 'absent').length;\n  const late = data.filter(r => r.status === 'late').length;\n  const excused = data.filter(r => r.status === 'excused').length;\n  return {\n    total,\n    present,\n    absent,\n    late,\n    excused,\n    attendanceRate: total > 0 ? ((present + late) / total * 100).toFixed(1) : '0'\n  };\n};","map":{"version":3,"names":["supabase","getAllAttendance","data","error","from","select","order","ascending","getAttendanceByDate","date","eq","getAttendanceByStudent","studentId","upsertAttendance","attendance","upsert","student_id","status","notes","onConflict","single","deleteAttendance","id","delete","getAttendanceStats","startDate","endDate","gte","lte","total","length","present","filter","r","absent","late","excused","attendanceRate","toFixed"],"sources":["C:/Users/diego/OneDrive/Escritorio/ProyectoAPT/CapStone-710V-/src/services/attendanceService.ts"],"sourcesContent":["import { supabase } from '../supabaseClient';\r\nimport { AttendanceRecord } from '../types';\r\n\r\nexport interface AttendanceWithStudent extends AttendanceRecord {\r\n  student?: {\r\n    name: string;\r\n    last_name: string;\r\n    grade: string;\r\n    section: string;\r\n  };\r\n}\r\n\r\n// obtener todos los registros de asistencia\r\nexport const getAllAttendance = async (): Promise<AttendanceWithStudent[]> => {\r\n  const { data, error } = await supabase\r\n    .from('attendance_records')\r\n    .select(`\r\n      *,\r\n      student:students (\r\n        name,\r\n        last_name,\r\n        grade,\r\n        section\r\n      )\r\n    `)\r\n    .order('date', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// obtener asistencia por fecha\r\nexport const getAttendanceByDate = async (date: string): Promise<AttendanceWithStudent[]> => {\r\n  const { data, error } = await supabase\r\n    .from('attendance_records')\r\n    .select(`\r\n      *,\r\n      student:students (\r\n        name,\r\n        last_name,\r\n        grade,\r\n        section\r\n      )\r\n    `)\r\n    .eq('date', date)\r\n    .order('student.last_name', { ascending: true });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// obtener asistencia por estudiante\r\nexport const getAttendanceByStudent = async (studentId: string): Promise<AttendanceRecord[]> => {\r\n  const { data, error } = await supabase\r\n    .from('attendance_records')\r\n    .select('*')\r\n    .eq('student_id', studentId)\r\n    .order('date', { ascending: false });\r\n\r\n  if (error) throw error;\r\n  return data || [];\r\n};\r\n\r\n// crear o actualizar registro de asistencia\r\nexport const upsertAttendance = async (\r\n  attendance: Omit<AttendanceRecord, 'id' | 'created_at' | 'updated_at'>\r\n): Promise<AttendanceRecord> => {\r\n  const { data, error } = await supabase\r\n    .from('attendance_records')\r\n    .upsert({\r\n      student_id: attendance.studentId,\r\n      date: attendance.date,\r\n      status: attendance.status,\r\n      notes: attendance.notes || null,\r\n    }, {\r\n      onConflict: 'student_id,date'\r\n    })\r\n    .select()\r\n    .single();\r\n\r\n  if (error) throw error;\r\n  return data;\r\n};\r\n\r\n// eliminar registro de asistencia\r\nexport const deleteAttendance = async (id: string): Promise<void> => {\r\n  const { error } = await supabase\r\n    .from('attendance_records')\r\n    .delete()\r\n    .eq('id', id);\r\n\r\n  if (error) throw error;\r\n};\r\n\r\n// obtener estadísticas de asistencia\r\nexport const getAttendanceStats = async (startDate: string, endDate: string) => {\r\n  const { data, error } = await supabase\r\n    .from('attendance_records')\r\n    .select('status')\r\n    .gte('date', startDate)\r\n    .lte('date', endDate);\r\n\r\n  if (error) throw error;\r\n\r\n  const total = data.length;\r\n  const present = data.filter(r => r.status === 'present').length;\r\n  const absent = data.filter(r => r.status === 'absent').length;\r\n  const late = data.filter(r => r.status === 'late').length;\r\n  const excused = data.filter(r => r.status === 'excused').length;\r\n\r\n  return {\r\n    total,\r\n    present,\r\n    absent,\r\n    late,\r\n    excused,\r\n    attendanceRate: total > 0 ? ((present + late) / total * 100).toFixed(1) : '0',\r\n  };\r\n};\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}